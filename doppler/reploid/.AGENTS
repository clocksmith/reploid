# Agent Instructions for REPLOID

## Critical Rules

1. **NO EMOJIS** - Read `EMOJI.md` for approved Unicode symbols
2. **Read before writing** - Always read existing files before modifying
3. **Minimal changes** - edit existing files, don't create unnecessary new ones

## Style Guidelines

- Use Unicode symbols from `EMOJI.md` for all visual indicators
- Use markdown checkboxes `[x]` and `[ ]` instead of emoji checkboxes
- Keep code clean and well-documented
- Follow existing patterns in the codebase
- See `docs/STYLE_GUIDE.md` for comprehensive style guide

## Before Starting

1. Read `EMOJI.md` for symbol reference
2. Read `docs/STYLE_GUIDE.md` for complete guidelines
3. Read `README.md` to understand project structure
4. Check `blueprints/` for architectural documentation

## Code Quality

- Write clear, self-documenting code
- Add comments for complex logic
- Keep functions small and focused
- Handle errors gracefully
- Use consistent naming conventions
- Follow the module pattern used throughout

## Documentation

- Update docs when changing functionality
- No emojis in documentation or blueprints
- Use approved Unicode symbols for lists and status indicators

## REPLOID-Specific

- UI components in `ui/components/`
- Infrastructure modules in `infrastructure/`
- Agent logic in `agents/`
- Examples in `examples/`
- Tests in `tests/`

## Quick Start

```bash
npm run reploid      # Serve proxy on :8000
npm run doppler      # Serve DOPPLER demo on :8080, opens browser
```

## DOPPLER Tests

### Test Files

| File                  | Purpose                                                             |
|-----------------------|---------------------------------------------------------------------|
| gemma-e2e.spec.ts     | E2E inference test - loads Gemma 1B, sends prompt, validates output |
| converter-e2e.spec.ts | E2E converter test - tests GGUF/SafeTensors to RDRR conversion      |
| test-runner.ts        | CLI test runner with two modes (direct/demo)                        |

### Test Modes

1. Playwright E2E (via specs)
```bash
npx playwright test doppler/tests/gemma-e2e.spec.ts --headed
npx playwright test doppler/tests/converter-e2e.spec.ts --headed
```

2. CLI Test Runner (manual)
```bash
# Direct mode (minimal HTML, tests pipeline)
npx tsx doppler/tests/test-runner.ts gemma --direct

# Demo mode (full UI, tests user flow)
npx tsx doppler/tests/test-runner.ts gemma --demo --headed

# With inspection time (keeps browser open)
npx tsx doppler/tests/test-runner.ts mistral --demo --inspect 30000

# Gemma 1B minimal test with inspection
npx tsx doppler/tests/test-runner.ts gemma --direct --inspect 30000 --headed
```

### What's Tested

| Test          | Coverage                                                |
|---------------|---------------------------------------------------------|
| gemma-e2e     | Model load, Prompt, Generation, Token quality           |
| converter-e2e | UI present, File input, Conversion, RDRR output         |
| test-runner   | Multi-model (gemma/mistral/gptoss), direct vs demo mode |

### Test Helpers

| Helper             | Purpose                               |
|--------------------|---------------------------------------|
| demo-page.ts       | Page object for demo UI interactions  |
| console-capture.ts | Captures logs, analyzes token quality |
| test-config.ts     | Model configs, timeouts, patterns     |

### Manual HTML Tests

| File                     | Purpose                     |
|--------------------------|-----------------------------|
| test-minimal.html        | Minimal inference test page |
| test-mistral-direct.html | Direct Mistral testing      |
| test-standalone.html     | Standalone test harness     |

### Performance Notes

- **Direct mode** is faster: minimal HTML, no UI overhead, tests pipeline directly
- **Demo mode** adds UI rendering, event handling, DOM interactions
- Inference time is GPU-bound (same either way), but test scaffolding differs

For quick iteration: `--direct`
For full user flow validation: `--demo`
