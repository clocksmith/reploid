<!DOCTYPE html>
<html>
<head>
  <title>Dreamer Kernel Tests</title>
  <style>
    body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #e0e0e0; }
    h1 { color: #4fc3f7; }
    .status { padding: 10px; margin: 10px 0; border-radius: 4px; }
    .ready { background: #1b5e20; }
    .error { background: #b71c1c; }
    .loading { background: #e65100; }
    #capabilities { margin: 20px 0; padding: 10px; background: #2d2d2d; border-radius: 4px; }
    #log { white-space: pre-wrap; background: #2d2d2d; padding: 10px; border-radius: 4px; max-height: 400px; overflow-y: auto; }
  </style>
</head>
<body>
  <h1>Dreamer GPU Kernel Test Runner</h1>
  <div id="status" class="status loading">Initializing WebGPU...</div>
  <div id="capabilities"></div>
  <div id="log"></div>

  <script type="module">
    // Import the test harness - this also sets up window.testHarness
    import { testHarness, getGPU } from './test-page.js';

    const log = (msg) => {
      const logEl = document.getElementById('log');
      logEl.textContent += msg + '\n';
      console.log(msg);
    };

    // Wait for GPU initialization (test-page.js initializes on DOMContentLoaded)
    window.addEventListener('DOMContentLoaded', async () => {
      try {
        log('Waiting for WebGPU initialization...');

        // Give it a moment to initialize
        await new Promise(resolve => setTimeout(resolve, 100));

        // Try to get the GPU
        const gpu = await getGPU();

        if (!gpu || !gpu.device) {
          throw new Error('WebGPU device not available');
        }

        document.getElementById('status').textContent = 'Ready';
        document.getElementById('status').className = 'status ready';

        log('WebGPU initialized successfully');
        log(`Test harness available: ${!!window.testHarness}`);
        log(`References available: ${!!window.testHarness?.references}`);

      } catch (e) {
        document.getElementById('status').textContent = `Error: ${e.message}`;
        document.getElementById('status').className = 'status error';
        log(`ERROR: ${e.message}`);
        log(e.stack);
        window.kernelTestError = e.message;
      }
    });
  </script>
</body>
</html>
